#!/bin/bash
echo "Hook ex√©cut√©"
exit 1  # Emp√™che le commit pour v√©rifier si le hook s‚Äôex√©cute bien
# Couleurs pour les messages
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

echo "üîç V√©rification de la structure du code avant commit..."

# V√©rification des fichiers PHP
PHP_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.php$')

if [[ -n "$PHP_FILES" ]]; then
    for file in $PHP_FILES; do
        php -l "$file"
        if [[ $? -ne 0 ]]; then
            echo -e "${RED}‚ùå Erreur de syntaxe dans $file${NC}"
            exit 1
        fi
    done
    echo -e "${GREEN}‚úÖ Aucune erreur PHP d√©tect√©e.${NC}"
fi

# V√©rification des fichiers JS avec ESLint
JS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.js$')

if [[ -n "$JS_FILES" ]]; then
    if ! command -v eslint &> /dev/null; then
        echo -e "${RED}‚ùå ESLint n'est pas install√©. Installez-le avec: npm install -g eslint${NC}"
        exit 1
    fi

    eslint $JS_FILES
    if [[ $? -ne 0 ]]; then
        echo -e "${RED}‚ùå Probl√®mes d√©tect√©s par ESLint.${NC}"
        exit 1
    fi
    echo -e "${GREEN}‚úÖ Aucun probl√®me JS d√©tect√©.${NC}"
fi

echo -e "${GREEN}üéâ Pr√©-commit valid√© avec succ√®s !${NC}"
exit 0
